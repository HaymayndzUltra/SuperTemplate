# Project-Specific Protocol Storage Structure

**Version**: 1.0.0  
**Created**: 2025-01-10  
**Purpose**: Define storage structure for project-specific generated protocol instances

---

## ğŸ¯ OVERVIEW

This document defines the storage structure for project-specific protocol instances generated by the Transformation Engine. The structure ensures:
- **Project Isolation**: Each project has its own protocol directory
- **Traceability**: Clear mapping between foundation templates and generated instances
- **Maintainability**: Easy to regenerate, update, or rollback protocols
- **Auditability**: Complete generation history and manifest tracking

---

## ğŸ“ DIRECTORY STRUCTURE

### Complete Structure

```
{project-root}/
â”œâ”€â”€ .cursor/
â”‚   â”œâ”€â”€ ai-driven-workflow/ (FOUNDATION TEMPLATES - READ-ONLY)
â”‚   â”‚   â”œâ”€â”€ 01-client-proposal-generation.md
â”‚   â”‚   â”œâ”€â”€ 02-client-discovery-initiation.md
â”‚   â”‚   â”œâ”€â”€ 03-project-brief-creation.md
â”‚   â”‚   â”œâ”€â”€ 04-project-bootstrap-and-context-engineering.md
â”‚   â”‚   â”œâ”€â”€ 05-bootstrap-your-project.md
â”‚   â”‚   â”œâ”€â”€ 05b-project-protocol-orchestration-v2.md
â”‚   â”‚   â”œâ”€â”€ 06-create-prd.md
â”‚   â”‚   â”œâ”€â”€ 07-technical-design-architecture.md
â”‚   â”‚   â”œâ”€â”€ 08-task-generation.md
â”‚   â”‚   â”œâ”€â”€ 09-environment-setup-validation.md
â”‚   â”‚   â”œâ”€â”€ 10-execute-tasks.md
â”‚   â”‚   â”œâ”€â”€ 11-integration-testing.md
â”‚   â”‚   â”œâ”€â”€ 12-quality-audit.md
â”‚   â”‚   â”œâ”€â”€ 13-uat-coordination.md
â”‚   â”‚   â”œâ”€â”€ 14-pre-deployment-staging.md
â”‚   â”‚   â”œâ”€â”€ 15-production-deployment.md
â”‚   â”‚   â”œâ”€â”€ 16-monitoring-observability.md
â”‚   â”‚   â”œâ”€â”€ 17-incident-response-rollback.md
â”‚   â”‚   â”œâ”€â”€ 18-performance-optimization.md
â”‚   â”‚   â””â”€â”€ ... (28+ protocols total)
â”‚   â”‚
â”‚   â””â”€â”€ project-protocols/ (PROJECT-SPECIFIC INSTANCES - GENERATED)
â”‚       â”œâ”€â”€ README.md (generation metadata and usage instructions)
â”‚       â”œâ”€â”€ .protocol-manifest.json (tracking file)
â”‚       â”œâ”€â”€ .generation-history.json (regeneration history)
â”‚       â”œâ”€â”€ 06-create-prd-{project-name}.md
â”‚       â”œâ”€â”€ 07-technical-design-{project-name}.md
â”‚       â”œâ”€â”€ 08-task-generation-{project-name}.md
â”‚       â”œâ”€â”€ 09-environment-setup-{project-name}.md
â”‚       â”œâ”€â”€ 10-execute-tasks-{project-name}.md
â”‚       â”œâ”€â”€ 11-integration-testing-{project-name}.md
â”‚       â”œâ”€â”€ 12-quality-audit-{project-name}.md
â”‚       â”œâ”€â”€ 13-uat-coordination-{project-name}.md
â”‚       â”œâ”€â”€ 14-pre-deployment-{project-name}.md
â”‚       â”œâ”€â”€ 15-production-deployment-{project-name}.md
â”‚       â”œâ”€â”€ 16-monitoring-observability-{project-name}.md
â”‚       â”œâ”€â”€ 17-incident-response-{project-name}.md
â”‚       â”œâ”€â”€ 18-performance-optimization-{project-name}.md
â”‚       â””â”€â”€ ... (only protocols needed for this project)
â”‚
â”œâ”€â”€ .artifacts/
â”‚   â”œâ”€â”€ protocol-05b/
â”‚   â”‚   â”œâ”€â”€ generation-manifest.json (complete generation metadata)
â”‚   â”‚   â”œâ”€â”€ generation-validation.json (validation results)
â”‚   â”‚   â”œâ”€â”€ PROTOCOL-GENERATION-REPORT.md (comprehensive report)
â”‚   â”‚   â””â”€â”€ ... (other Protocol 05b artifacts)
â”‚   â”‚
â”‚   â””â”€â”€ {project-name}/
â”‚       â”œâ”€â”€ protocol-06/
â”‚       â”œâ”€â”€ protocol-07/
â”‚       â””â”€â”€ ... (project-specific protocol artifacts)
â”‚
â”œâ”€â”€ PROJECT-BRIEF.md (source of project information)
â”œâ”€â”€ PROTOCOL-EXECUTION-PLAN.md (execution roadmap with generation details)
â””â”€â”€ PROTOCOL-CHECKLIST.md (tracking tool)
```

---

## ğŸ“„ FILE SPECIFICATIONS

### 1. `.cursor/project-protocols/README.md`

**Purpose**: Provide generation metadata and usage instructions

**Content**:
```markdown
# Project-Specific Protocols: {PROJECT_NAME}

**Generated**: 2025-01-10T14:30:00Z  
**Project Type**: Web Application  
**Foundation Version**: 1.0.0  
**Transformation Engine**: 1.0.0

## Overview
This directory contains customized protocol instances generated specifically for the **{PROJECT_NAME}** project. These protocols are derived from foundation templates in `.cursor/ai-driven-workflow/` with project-specific customizations applied.

## Protocols Generated
- Protocol 06: Create PRD (customized for {PROJECT_NAME})
- Protocol 07: Technical Design Architecture (customized for {PROJECT_NAME})
- Protocol 08: Task Generation (customized for {PROJECT_NAME})
- ... (15 protocols total)

## Customizations Applied
- **Tech Stack**: Next.js 14, FastAPI, PostgreSQL
- **Project Type**: Web Application
- **Complexity**: Standard
- **Team Size**: Solo Developer
- **Domain**: E-commerce Analytics

## Usage
Execute protocols in the order specified in `PROTOCOL-EXECUTION-PLAN.md`. Each protocol file contains:
- Project-specific workflow steps
- Customized validation gates
- Tech stack-specific automation scripts
- Project-specific artifact paths

## Regeneration
To regenerate protocols (e.g., after foundation template updates):
```bash
python scripts/orchestration/regenerate_protocols.py \
  --project-root . \
  --force
```

## Maintenance
- **DO NOT** manually edit generated protocols (changes will be lost on regeneration)
- **DO** update foundation templates in `.cursor/ai-driven-workflow/` and regenerate
- **DO** update PROJECT-BRIEF.md if project requirements change, then regenerate

## Manifest
See `.protocol-manifest.json` for complete generation details and traceability.
```

---

### 2. `.cursor/project-protocols/.protocol-manifest.json`

**Purpose**: Track generated protocols for audit and regeneration

**Schema**:
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["generation_timestamp", "project_name", "protocols_generated"],
  "properties": {
    "generation_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of generation"
    },
    "project_name": {
      "type": "string",
      "description": "Project name (kebab-case)"
    },
    "project_type": {
      "type": "string",
      "enum": ["Web Application", "AI/ML Application", "Mobile Application", "API/Microservice", "Data Pipeline", "Hybrid", "Other"]
    },
    "foundation_version": {
      "type": "string",
      "description": "Version of foundation templates used"
    },
    "transformation_engine_version": {
      "type": "string",
      "description": "Version of transformation engine"
    },
    "protocols_generated": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["protocol_id", "protocol_name", "source_template", "generated_file"],
        "properties": {
          "protocol_id": {
            "type": "string",
            "pattern": "^[0-9]{2}[a-z]?$"
          },
          "protocol_name": {
            "type": "string"
          },
          "source_template": {
            "type": "string",
            "description": "Path to foundation template"
          },
          "generated_file": {
            "type": "string",
            "description": "Path to generated protocol instance"
          },
          "customizations_applied": {
            "type": "array",
            "items": {"type": "string"},
            "description": "List of transformation rules applied"
          },
          "validation_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "11-validator system score (0.0-1.0)"
          },
          "generation_duration_ms": {
            "type": "integer",
            "description": "Time taken to generate this protocol (milliseconds)"
          }
        }
      }
    },
    "total_protocols": {
      "type": "integer",
      "description": "Total number of protocols generated"
    },
    "total_customizations": {
      "type": "integer",
      "description": "Total number of customizations applied across all protocols"
    },
    "total_duration_ms": {
      "type": "integer",
      "description": "Total generation time (milliseconds)"
    },
    "validation_summary": {
      "type": "object",
      "properties": {
        "protocols_passed": {"type": "integer"},
        "protocols_failed": {"type": "integer"},
        "average_score": {"type": "number"},
        "min_score": {"type": "number"},
        "max_score": {"type": "number"}
      }
    }
  }
}
```

**Example**:
```json
{
  "generation_timestamp": "2025-01-10T14:30:00Z",
  "project_name": "artisans-corner-dashboard",
  "project_type": "Web Application",
  "foundation_version": "1.0.0",
  "transformation_engine_version": "1.0.0",
  "protocols_generated": [
    {
      "protocol_id": "06",
      "protocol_name": "Create PRD",
      "source_template": ".cursor/ai-driven-workflow/06-create-prd.md",
      "generated_file": ".cursor/project-protocols/06-create-prd-artisans-corner.md",
      "customizations_applied": [
        "project_name_substitution",
        "tech_stack_customization_nextjs",
        "tech_stack_customization_fastapi",
        "workflow_step_customization_solo",
        "artifact_path_customization",
        "validation_rule_injection_ecommerce"
      ],
      "validation_score": 0.97,
      "generation_duration_ms": 1250
    }
  ],
  "total_protocols": 15,
  "total_customizations": 42,
  "total_duration_ms": 18750,
  "validation_summary": {
    "protocols_passed": 15,
    "protocols_failed": 0,
    "average_score": 0.96,
    "min_score": 0.95,
    "max_score": 0.98
  }
}
```

---

### 3. `.cursor/project-protocols/.generation-history.json`

**Purpose**: Track regeneration history for audit and rollback

**Schema**:
```json
{
  "generations": [
    {
      "generation_id": "gen-001",
      "timestamp": "2025-01-10T14:30:00Z",
      "trigger": "initial_generation",
      "foundation_version": "1.0.0",
      "protocols_generated": 15,
      "validation_passed": true,
      "manifest_file": ".protocol-manifest-gen-001.json"
    },
    {
      "generation_id": "gen-002",
      "timestamp": "2025-01-15T10:15:00Z",
      "trigger": "foundation_template_update",
      "foundation_version": "1.1.0",
      "protocols_regenerated": 15,
      "validation_passed": true,
      "manifest_file": ".protocol-manifest-gen-002.json",
      "changes": [
        "Updated Protocol 06 with new validation gates",
        "Enhanced Protocol 08 with parallel task execution"
      ]
    }
  ]
}
```

---

### 4. Generated Protocol File Naming Convention

**Format**: `{protocol-id}-{protocol-name}-{project-name}.md`

**Examples**:
- `06-create-prd-artisans-corner.md`
- `07-technical-design-artisans-corner.md`
- `08-task-generation-artisans-corner.md`

**Rationale**:
- **Protocol ID**: Easy sorting and identification
- **Protocol Name**: Human-readable description
- **Project Name**: Clear project association

**Alternative Format** (if project name too long):
- `{protocol-id}-{protocol-name}-{project-abbreviation}.md`
- Example: `06-create-prd-ac-dashboard.md`

---

## ğŸ”„ LIFECYCLE MANAGEMENT

### Initial Generation

```bash
# Triggered by Protocol 05b PHASE 7
python scripts/orchestration/transform_protocols.py \
  --templates .artifacts/protocol-05b/loaded-templates.json \
  --project-brief PROJECT-BRIEF.md \
  --execution-plan PROTOCOL-EXECUTION-PLAN.md \
  --output .artifacts/protocol-05b/transformed-protocols.json
```

**Output**:
- `.cursor/project-protocols/` directory created
- 15+ protocol files generated
- `.protocol-manifest.json` created
- `.generation-history.json` initialized

---

### Regeneration

**Triggers**:
1. Foundation template updated
2. PROJECT-BRIEF.md changed
3. User requests regeneration
4. Validation failure detected

**Command**:
```bash
python scripts/orchestration/regenerate_protocols.py \
  --project-root . \
  --force \
  --backup
```

**Process**:
1. Backup existing generated protocols
2. Re-read PROJECT-BRIEF.md
3. Re-load foundation templates
4. Re-apply transformation rules
5. Re-validate generated protocols
6. Update `.protocol-manifest.json`
7. Append to `.generation-history.json`

---

### Rollback

**Scenario**: Generated protocols have issues, need to rollback to previous generation

**Command**:
```bash
python scripts/orchestration/rollback_protocols.py \
  --project-root . \
  --generation-id gen-001
```

**Process**:
1. Read `.generation-history.json`
2. Locate specified generation
3. Restore protocols from backup
4. Update `.protocol-manifest.json`
5. Log rollback in `.generation-history.json`

---

## ğŸ“Š STORAGE METRICS

### Disk Space Estimation

**Per Protocol**:
- Foundation template: ~50-150 KB
- Generated instance: ~60-180 KB (10-20% larger due to customizations)

**Per Project**:
- 15 protocols Ã— 120 KB average = ~1.8 MB
- Manifest files: ~50 KB
- Generation history: ~20 KB
- **Total**: ~2 MB per project

**Workspace with 10 Projects**:
- Foundation templates (shared): ~3 MB
- Project-specific instances: ~20 MB
- **Total**: ~23 MB

---

## ğŸ”’ SECURITY & PERMISSIONS

### Directory Permissions

```bash
# .cursor/ai-driven-workflow/ (foundation templates)
chmod 755 .cursor/ai-driven-workflow/
chmod 644 .cursor/ai-driven-workflow/*.md

# .cursor/project-protocols/ (generated instances)
chmod 755 .cursor/project-protocols/
chmod 644 .cursor/project-protocols/*.md
chmod 644 .cursor/project-protocols/.protocol-manifest.json
```

### Access Control

- **Foundation Templates**: Read-only for all users
- **Generated Protocols**: Read-only after generation (prevent manual edits)
- **Manifest Files**: Read-only after generation
- **Generation Scripts**: Execute permission for automation

---

## ğŸ§¹ CLEANUP & MAINTENANCE

### Cleanup Old Generations

```bash
# Remove generations older than 90 days
python scripts/orchestration/cleanup_old_generations.py \
  --project-root . \
  --days 90
```

### Validate Storage Integrity

```bash
# Verify all generated protocols exist and are valid
python scripts/orchestration/validate_storage_integrity.py \
  --project-root .
```

### Compress for Archival

```bash
# Compress project-protocols for long-term storage
tar -czf project-protocols-backup-$(date +%Y%m%d).tar.gz .cursor/project-protocols/
```

---

## ğŸ“ BEST PRACTICES

### DO
âœ… Keep foundation templates in `.cursor/ai-driven-workflow/` as single source of truth  
âœ… Regenerate protocols after foundation template updates  
âœ… Backup before regeneration  
âœ… Use manifest files for traceability  
âœ… Validate generated protocols with 11-validator system  

### DON'T
âŒ Manually edit generated protocols (changes will be lost)  
âŒ Delete `.protocol-manifest.json` (breaks traceability)  
âŒ Mix foundation templates with generated instances  
âŒ Skip validation after generation  
âŒ Ignore regeneration warnings  

---

## ğŸ” TROUBLESHOOTING

### Issue 1: Directory Creation Failed
**Symptom**: `.cursor/project-protocols/` not created  
**Cause**: Insufficient permissions or disk space  
**Solution**: Check permissions, ensure disk space available

### Issue 2: Manifest File Corrupted
**Symptom**: `.protocol-manifest.json` invalid JSON  
**Cause**: Generation interrupted or disk error  
**Solution**: Restore from `.generation-history.json` or regenerate

### Issue 3: Generated Protocols Missing
**Symptom**: Expected protocols not in directory  
**Cause**: Generation failed or protocols skipped  
**Solution**: Check generation logs, re-run generation

---

## ğŸ“š REFERENCES

- **Protocol 05b PHASE 7**: Main generation workflow
- **Transformation Engine**: Template transformation logic
- **Decision Framework**: Architectural rationale for storage structure
- **11-Validator System**: Validation requirements for generated protocols

---

**Status**: âœ… Active  
**Maintained By**: Storage Architecture Team  
**Last Updated**: 2025-01-10
