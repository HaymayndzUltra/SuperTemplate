# Protocol 10 Requirements (Pre-Deployment Validation & Staging Readiness)
protocol_number: "10"
protocol_name: "pre-deployment-staging"
domain_compliance: "Release"
purpose: "Ensure the release candidate is production-ready by validating staging parity, rehearsing deployments, and confirming rollback and security readiness."

aio_role: "Release Engineer"
primary_guardrail: "Do not deliver a production go/no-go package without successful staging deployment, rollback rehearsal, and documented approvals."
prerequisites:
  - protocol: "4-quality-audit"
    required_artifacts: "quality audit findings, risk exceptions, approval status"
  - protocol: "9-integration-testing"
    required_artifacts: "integration evidence bundle, environment validation report, defect log"
  - protocol: "7-environment-setup-validation"
    required_artifacts: "environment baseline, configuration manifests, secrets governance"
phase_in_workflow: "Between Protocol 4 (Quality Audit) and Protocol 11 (Production Deployment)"

phases:
  - phase_number: 1
    phase_name: "Intake Validation and Staging Alignment"
    objective: "Verify upstream approvals and confirm staging environment matches production constraints."
    steps:
      - step_number: 1
        action_type: "MUST"
        action_title: "Confirm Upstream Approvals"
        instructions: "Validate quality audit sign-off, integration approval, and security waivers."
        communication_template: "[PHASE 1 START] - Validating upstream approvals and artifact completeness..."
        halt_condition: "Stop if any approval is missing or expired."
      - step_number: 2
        action_type: "MUST"
        action_title: "Validate Staging Parity"
        instructions: "Compare staging vs production configurations, secrets, and infra baselines."
        communication_template: "Comparing staging configuration to production baseline..."
        halt_condition: ""
      - step_number: 3
        action_type: "GUIDELINE"
        action_title: "Refresh Test Data"
        instructions: "Sync datasets, feature flags, and external stubs for the release candidate."
        communication_template: "Refreshing staging datasets and feature flags..."
        halt_condition: ""
    evidence_collection:
      - evidence_item: "Intake validation report"
        storage_location: ".artifacts/pre-deployment/intake-validation-report.json"
      - evidence_item: "Staging parity report"
        storage_location: ".artifacts/pre-deployment/staging-parity-report.json"
      - evidence_item: "Data refresh log"
        storage_location: ".artifacts/pre-deployment/staging-data-refresh.md"
    quality_gate:
      gate_name: "Intake Confirmation Gate"
      criteria: "Approvals verified and staging parity confirmed."
      failure_handling: "Resolve missing approvals or configuration drift before continuing."
  - phase_number: 2
    phase_name: "Deployment Rehearsal and Verification"
    objective: "Execute deployment rehearsal on staging and validate functional readiness."
    steps:
      - step_number: 1
        action_type: "MUST"
        action_title: "Execute Staging Deployment"
        instructions: "Run deployment scripts mirroring production plan with full logging."
        communication_template: "[PHASE 2 START] - Rehearsing deployment on staging environment..."
        halt_condition: ""
      - step_number: 2
        action_type: "MUST"
        action_title: "Run Smoke & Acceptance Tests"
        instructions: "Execute smoke, end-to-end, and regression suites on staging release candidate."
        communication_template: "Executing staging smoke and acceptance tests..."
        halt_condition: ""
      - step_number: 3
        action_type: "GUIDELINE"
        action_title: "Capture Observability Baseline"
        instructions: "Record metrics and dashboards to set expectations for production monitoring."
        communication_template: "Capturing observability baseline for production handoff..."
        halt_condition: ""
    evidence_collection:
      - evidence_item: "Staging deployment log"
        storage_location: ".artifacts/pre-deployment/staging-deployment-run.log"
      - evidence_item: "Staging test results"
        storage_location: ".artifacts/pre-deployment/staging-test-results.json"
      - evidence_item: "Observability baseline"
        storage_location: ".artifacts/pre-deployment/observability-baseline.md"
    quality_gate:
      gate_name: "Deployment Rehearsal Gate"
      criteria: "Staging deployment successful and tests passed."
      failure_handling: "Fix failures and rerun rehearsal before proceeding."
  - phase_number: 3
    phase_name: "Rollback, Security, and Operational Readiness"
    objective: "Prove rollback capabilities and ensure security/compliance readiness."
    steps:
      - step_number: 1
        action_type: "MUST"
        action_title: "Rehearse Rollback"
        instructions: "Execute rollback scripts or blue/green switchback with full logging."
        communication_template: "[PHASE 3 START] - Verifying rollback and recovery procedures..."
        halt_condition: ""
      - step_number: 2
        action_type: "MUST"
        action_title: "Run Security & Compliance Checks"
        instructions: "Execute required security scans, license audits, and compliance validations."
        communication_template: "Running security and compliance validations for release..."
        halt_condition: ""
      - step_number: 3
        action_type: "GUIDELINE"
        action_title: "Validate Operational Readiness"
        instructions: "Update runbooks, on-call rotations, and escalation matrices."
        communication_template: "Reviewing operational readiness documentation..."
        halt_condition: ""
    evidence_collection:
      - evidence_item: "Rollback verification report"
        storage_location: ".artifacts/pre-deployment/rollback-verification-report.json"
      - evidence_item: "Security compliance report"
        storage_location: ".artifacts/pre-deployment/security-compliance-report.json"
      - evidence_item: "Operational readiness checklist"
        storage_location: ".artifacts/pre-deployment/operational-readiness-checklist.md"
    quality_gate:
      gate_name: "Rollback & Security Gate"
      criteria: "Rollback successful and security checks cleared or mitigated."
      failure_handling: "Address rollback or security gaps prior to readiness review."
  - phase_number: 4
    phase_name: "Final Readiness Review and Handoff"
    objective: "Compile go/no-go package, capture approvals, and update deployment documentation."
    steps:
      - step_number: 1
        action_type: "MUST"
        action_title: "Assemble Go/No-Go Package"
        instructions: "Bundle all readiness artifacts into a shareable archive with manifest."
        communication_template: "[PHASE 4 START] - Compiling pre-deployment readiness package for release approval..."
        halt_condition: ""
      - step_number: 2
        action_type: "MUST"
        action_title: "Conduct Readiness Review"
        instructions: "Meet with release stakeholders to capture approval decisions and conditions."
        communication_template: "Conducting readiness review with release stakeholders..."
        halt_condition: ""
      - step_number: 3
        action_type: "GUIDELINE"
        action_title: "Update Deployment Checklist"
        instructions: "Incorporate rehearsal learnings into production deployment checklist and comms plan."
        communication_template: "Updating deployment checklist and communications..."
        halt_condition: ""
    evidence_collection:
      - evidence_item: "Pre-deployment manifest"
        storage_location: ".artifacts/pre-deployment/pre-deployment-manifest.json"
      - evidence_item: "Readiness approval record"
        storage_location: ".artifacts/pre-deployment/readiness-approval.json"
      - evidence_item: "Deployment checklist updates"
        storage_location: ".artifacts/pre-deployment/deployment-checklist.md"
    quality_gate:
      gate_name: "Readiness Approval Gate"
      criteria: "Go/no-go package complete with approvals and updated checklist."
      failure_handling: "Defer handoff until approvals recorded and documentation updated."

integration_inputs:
  - source_protocol: "4-quality-audit"
    artifacts_consumed: "quality audit approvals, risk exceptions"
  - source_protocol: "9-integration-testing"
    artifacts_consumed: "integration evidence bundle, environment validation report"
  - source_protocol: "7-environment-setup-validation"
    artifacts_consumed: "environment baseline, configuration manifests"
integration_outputs:
  - target_protocol: "11-production-deployment"
    artifacts_produced: "PRE-DEPLOYMENT-PACKAGE.zip, pre-deployment-manifest.json, readiness-approval.json, deployment-checklist.md"
  - target_protocol: "12-monitoring-observability"
    artifacts_produced: "observability-baseline.md, security-compliance-report.json"
  - target_protocol: "13-incident-response-rollback"
    artifacts_produced: "rollback-verification-report.json"

communication_templates:
  status_announcements:
    - "[PHASE 1 START] - Validating upstream approvals and artifact completeness..."
    - "[PHASE 2 START] - Rehearsing deployment on staging environment..."
    - "[PHASE 3 START] - Verifying rollback and recovery procedures..."
    - "[PHASE 4 START] - Compiling pre-deployment readiness package for release approval..."
  validation_prompts:
    - "[DRIFT ALERT] Staging parity check failed. Confirm remediation applied before continuing? (yes/no)"
    - "[READINESS REVIEW] Pre-deployment package compiled. Approve handoff to Protocol 11? (yes/no)"
  error_handling:
    - "ParityMismatch: Apply remediation, rerun parity validation, log changes."
    - "RehearsalFailure: Rollback staging, fix automation issues, rerun deployment rehearsal."
    - "SecurityBlocker: Escalate to security owner, implement fixes, rerun scan before approval."

quality_gates_summary:
  - gate_name: "Intake Confirmation Gate"
    criteria: "Approvals verified, staging parity confirmed."
  - gate_name: "Deployment Rehearsal Gate"
    criteria: "Rehearsal executed and tests passed."
  - gate_name: "Rollback & Security Gate"
    criteria: "Rollback verified, security cleared."
  - gate_name: "Readiness Approval Gate"
    criteria: "Package complete, approvals recorded."
