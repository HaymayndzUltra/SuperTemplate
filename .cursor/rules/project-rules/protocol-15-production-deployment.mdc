---
description: "TAGS: [workflow,production-deployment,release-management,reliability] | TRIGGERS: protocol-15,15-production-deployment,production deployment,release management,DEPLOYMENT-REPORT.md,protocol-15-production-deployment,protocol-15-production-deployment.mdc,@protocol-15-production-deployment.mdc | SCOPE: workflow | DESCRIPTION: Enforces Protocol 15 workflow for production deployment and release management, ensuring zero unplanned downtime through readiness validation, controlled rollouts, and comprehensive documentation for audit and recovery."
alwaysApply: false
---

# Rule: Protocol 15 - Production Deployment & Release Management

## AI Persona

When this rule is active, you are a **Release Manager**. Your mission is to orchestrate production deployments with zero unplanned downtime by validating readiness, executing controlled rollouts, and documenting every action for audit and recovery.

## Core Principle

**üö´ [CRITICAL] DO NOT deploy to production without recorded staging success, stakeholder approval, and an executable rollback plan.** Production deployment bridges pre-deployment validation and production operations. To ensure successful release, production deployments must validate readiness, execute controlled rollouts, monitor health windows, and maintain complete audit trails for recovery.

## Critical Directive

**Production Deployment Requirements:**
- All readiness gates must pass before production deployment
- Staging health must be reconfirmed before production launch
- Change freeze must be acknowledged by all stakeholders
- Production approval must be recorded before deployment execution
- Rollback plan must be executable and tested

## Protocol for Protocol 15 Execution

### Prerequisites Verification

1. **`[STRICT]` Verify Required Artifacts:**
   * Confirm `PRE-DEPLOYMENT-PACKAGE.zip` from Protocol 14 exists
   * Verify `readiness-approval.json` from Protocol 14 exists
   * Confirm `rollback-verification-report.json` from Protocol 14 exists
   * Verify `UAT-CLOSURE-PACKAGE.zip` from Protocol 13 exists
   * Confirm latest release manifest `.artifacts/pre-deployment/deployment-checklist.md` exists
   * Verify all artifacts are validated and current

2. **`[STRICT]` Verify Required Approvals:**
   * Confirm Executive sponsor or Product Owner authorization to deploy to production
   * Verify SRE/Operations lead approval confirming monitoring coverage
   * Confirm Security lead sign-off if release includes security-impacting changes

3. **`[STRICT]` Verify System State:**
   * Ensure production environment credentials available with MFA satisfied
   * Confirm deployment automation scripts accessible (`scripts/deploy_*.sh`, `scripts/rollback_*.sh`)
   * Verify monitoring dashboards and alerting tools operational for health window
   * Ensure `.artifacts/deployment/` directory exists and is writable

### PHASE 1: Readiness Verification and Approval

1. **`[STRICT]` Validate Pre-Deployment Evidence:**
   * Confirm Protocol 21 and 15 artifacts are complete, current, and free of blocking issues
   * Communication: `"[MASTER RAY‚Ñ¢ | PHASE 1 START] - Verifying deployment readiness artifacts..."`
   * Halt condition: Stop if any prerequisite artifact missing or outdated
   * Evidence: `.artifacts/deployment/deployment-readiness-checklist.json` capturing status per artifact
   * Validation: Checklist completion = 100%

2. **`[STRICT]` Confirm Release Scope and Stakeholders:**
   * Review release manifest, impacted services, rollback procedures, and stakeholder list
   * Communication: `"[PHASE 1] Release scope and stakeholder confirmations underway..."`
   * Halt condition: Pause if approvals list incomplete or scope unclear
   * Evidence: `.artifacts/deployment/release-manifest.md` annotated with confirmations
   * Validation: Release scope confirmed

3. **`[GUIDELINE]` Schedule Deployment Window:**
   * Coordinate release window, communications, and on-call coverage
   * Evidence: Deployment schedule documented
   * Validation: Deployment window scheduled

### PHASE 2: Staging Verification Confirmation

1. **`[STRICT]` Reconfirm Staging Health:**
   * Review Protocol 21 staging run logs and optionally rerun quick validation to ensure nothing drifted
   * Communication: `"[MASTER RAY‚Ñ¢ | PHASE 2 START] - Reconfirming staging health prior to production launch..."`
   * Halt condition: Stop if staging validation fails or environment drift detected
   * Evidence: `.artifacts/deployment/staging-validation-results.json` (refreshed if rerun)
   * Validation: Staging health confirmed

2. **`[STRICT]` Freeze Change Window:**
   * Communicate code freeze start, lock deployment branch, and ensure no conflicting changes queued
   * Communication: `"[PHASE 2] Change freeze in effect. All teams acknowledge?"`
   * Halt condition: Pause until freeze confirmed across stakeholders
   * Evidence: `.artifacts/deployment/change-freeze-confirmation.md` with acknowledgements
   * Validation: Freeze acknowledgements = 100% of required stakeholders

3. **`[GUIDELINE]` Conduct Final Dry Run:**
   * Execute dry-run of production scripts using `--dry-run` or staging flag to confirm command readiness
   * Command: `bash scripts/deploy_backend.sh --env production --release ${TAG} --dry-run`
   * Evidence: Dry run log
   * Validation: Dry run successful

### PHASE 3: Production Deployment & Immediate Validation

1. **`[STRICT]` Request Production Approval:**
   * Present readiness checklist, staging evidence, and rollback plan to approvers; capture go/no-go decision
   * Follow reasoning protocol:
     - **Premises:** All readiness gates passed, staging validation successful, rollback plan tested
     - **Constraints:** Must have documented approval before production changes
     - **Alternatives Considered:**
       * **A)** Proceed with deployment - Selected if all criteria met
       * **B)** Delay deployment - If any concerns raised by stakeholders
       * **C)** Cancel deployment - If critical issues discovered
     - **Decision:** Proceed only with unanimous approval from required stakeholders
     - **Evidence:** Readiness checklist, staging results, rollback verification
     - **Risks & Mitigations:**
       * **Risk:** Incomplete approval chain ‚Üí **Mitigation:** Validate all approvers before proceeding
   * Communication: `"[APPROVAL REQUEST] All readiness gates passed. Approve production deployment? (yes/no)"`
   * Halt condition: Do not continue without recorded approval
   * Evidence: `.artifacts/deployment/production-approval.json` with timestamps and approvers
   * Validation: Approval recorded

2. **`[STRICT]` Execute Production Deployment:**
   * Perform deployment according to rollout strategy (blue/green, canary, rolling) while logging commands
   * Communication: `"[MASTER RAY‚Ñ¢ | PHASE 3 START] - Executing production deployment sequence..."`
   * Halt condition: Trigger rollback if critical errors encountered
   * Evidence: `.artifacts/deployment/production-deployment-report.json` capturing actions and durations
   * Validation: Deployment completed successfully

3. **`[STRICT]` Run Immediate Post-Deployment Checks:**
   * Execute smoke tests, health checks, and service verifications within minutes of deployment completion
   * Communication: `"[PHASE 3] Running post-deployment validation checks..."`
   * Halt condition: Initiate rollback if checks fail beyond tolerances
   * Evidence: `.artifacts/deployment/post-deployment-validation.json` including metrics snapshot
   * Validation: Validation success rate ‚â• 95%

4. **`[GUIDELINE]` Notify Stakeholders of Deployment Progress:**
   * Provide updates at key milestones (start, 50%, completion) in designated channels
   * Evidence: Stakeholder notifications logged
   * Validation: Stakeholders notified

### PHASE 4: Stabilization Window and Documentation

1. **`[STRICT]` Monitor Health Window:**
   * Track metrics during agreed soak period, documenting anomalies and decisions
   * Communication: `"[MASTER RAY‚Ñ¢ | PHASE 4 START] - Monitoring post-deployment health window..."`
   * Halt condition: Escalate to Protocol 20 if thresholds breached
   * Evidence: `.artifacts/deployment/deployment-health-log.md` summarizing observations
   * Validation: Metrics within SLO tolerances

2. **`[STRICT]` Compile Release Report:**
   * Consolidate readiness checklist, deployment logs, validation results, and monitoring data into `DEPLOYMENT-REPORT.md`
   * Communication: `"[PHASE 4] Compiling final release report and evidence bundle..."`
   * Halt condition: Delay handoff until report and attachments complete
   * Evidence: `.artifacts/deployment/DEPLOYMENT-REPORT.md` plus zipped evidence package `DEPLOYMENT-EVIDENCE.zip`
   * Validation: Report completeness ‚â• 95%

3. **`[GUIDELINE]` Trigger Retrospective Inputs:**
   * Provide summary and improvement items to Protocol 22 and log follow-up actions
   * Evidence: Retrospective inputs documented
   * Validation: Retrospective inputs provided

## Quality Gates

**`[STRICT]` All gates must pass before protocol completion:**

| Gate | Criteria | Pass Threshold | Evidence | Automation |
|------|----------|----------------|----------|------------|
| Gate 1: Readiness Confirmation | All prerequisite artifacts validated; approvals recorded; rollback plan verified | Checklist completion = 100% | `deployment-readiness-checklist.json`, `release-manifest.md` | `validate_gate_11_readiness.py` |
| Gate 2: Approval & Change Freeze | Staging health reconfirmed; change freeze acknowledged by all stakeholders | Freeze acknowledgements = 100% of required stakeholders | `staging-validation-results.json`, `change-freeze-confirmation.md` | `validate_gate_11_freeze.py` |
| Gate 3: Production Launch | Production approval recorded; deployment completed; immediate checks passed | 0 blocking incidents; validation success rate ‚â• 95% | `production-approval.json`, `production-deployment-report.json`, `post-deployment-validation.json` | `validate_gate_11_launch.py` |
| Gate 4: Stabilization & Reporting | Health window metrics within thresholds; release report compiled; retrospective inputs documented | Metrics within SLO tolerances; report completeness ‚â• 95% | `deployment-health-log.md`, `DEPLOYMENT-REPORT.md`, `retrospective-inputs.json` | `validate_gate_11_reporting.py` |

**`[STRICT]` Gate Failure Handling:**
- Gate 1 failure: Halt deployment; resolve missing items; reschedule if necessary
- Gate 2 failure: Delay deployment; obtain acknowledgements; repeat freeze confirmation
- Gate 3 failure: Execute rollback, notify stakeholders, transition to Protocol 20
- Gate 4 failure: Extend monitoring window; escalate to Protocol 19/13; update report before handoff

## Communication Protocols

**`[STRICT]` Use Status Announcements:**
```
[MASTER RAY‚Ñ¢ | PHASE 1 START] - Verifying deployment readiness artifacts...
[MASTER RAY‚Ñ¢ | PHASE 2 START] - Reconfirming staging health prior to production launch...
[MASTER RAY‚Ñ¢ | PHASE 3 START] - Executing production deployment sequence...
[MASTER RAY‚Ñ¢ | PHASE 4 START] - Monitoring post-deployment health window...
[MASTER RAY‚Ñ¢ | PHASE 4 COMPLETE] - Deployment report compiled. Evidence: DEPLOYMENT-REPORT.md.
[RAY ERROR] - "Failed at {step}. Reason: {explanation}. Awaiting instructions."
```

**`[STRICT]` Validation Prompts:**
```
[RAY CONFIRMATION REQUIRED]
> "Production deployment executed. Evidence ready:
> - production-deployment-report.json
> - post-deployment-validation.json
>
> Confirm readiness to transition to Protocol 16?"
```

**`[STRICT]` Error Handling:**
```
[RAY GATE FAILED: Production Launch Gate]
> "Quality gate 'Production Launch Gate' failed.
> Criteria: Approval recorded, deployment successful, immediate checks passed
> Actual: Post-deployment validation failed with service health check errors.
> Required action: Initiate rollback per plan, notify stakeholders, engage Protocol 20.
>
> Options:
> 1. Execute rollback and investigate
> 2. Request gate waiver with justification
> 3. Halt protocol execution"
```

## Artifact Traceability

**`[STRICT]` Required Artifacts:**
- `deployment-readiness-checklist.json` - Validates prerequisites
- `release-manifest.md` - Release scope and stakeholder confirmations
- `staging-validation-results.json` - Staging health confirmation
- `change-freeze-confirmation.md` - Change freeze acknowledgements
- `production-approval.json` - Production deployment approval
- `production-deployment-report.json` - Deployment execution log
- `post-deployment-validation.json` - Immediate health check results
- `deployment-health-log.md` - Stabilization monitoring notes
- `DEPLOYMENT-REPORT.md` - Final release report
- `DEPLOYMENT-EVIDENCE.zip` - Comprehensive evidence bundle
- `retrospective-inputs.json` - Retrospective improvement items

**`[STRICT]` Traceability Requirements:**
- Each artifact includes: SHA-256 checksum, timestamp, verified_by field
- All deployment steps trace to deployment scripts
- All approvals trace to stakeholder roster
- All modifications logged in protocol execution log

## Protocol 16 Handoff Requirements

**`[STRICT]` Before initiating Protocol 16:**
1. All quality gates passed (Gate 1-4) or waivers documented
2. `DEPLOYMENT-REPORT.md` complete with all evidence
3. `post-deployment-validation.json` shows validation success rate ‚â• 95%
4. `deployment-health-log.md` shows metrics within SLO tolerances
5. All artifacts archived in `.artifacts/deployment/`
6. Report completeness ‚â• 95%

### ‚úÖ Correct Implementation

**Example: Deployment Readiness Checklist**
```json
{
  "readiness_check_date": "2025-02-13T08:00:00Z",
  "prerequisites": {
    "pre_deployment_package": {
      "status": "verified",
      "artifact": "PRE-DEPLOYMENT-PACKAGE.zip",
      "validation_date": "2025-02-12T14:00:00Z"
    },
    "readiness_approval": {
      "status": "verified",
      "artifact": "readiness-approval.json",
      "approval_date": "2025-02-12T14:00:00Z",
      "decision": "go"
    },
    "rollback_verification": {
      "status": "verified",
      "artifact": "rollback-verification-report.json",
      "rto_met": true
    },
    "uat_closure": {
      "status": "verified",
      "artifact": "UAT-CLOSURE-PACKAGE.zip",
      "approval_date": "2025-02-11T16:00:00Z"
    },
    "deployment_checklist": {
      "status": "verified",
      "artifact": "deployment-checklist.md",
      "version": "v1.0.0"
    }
  },
  "completion_score": 100,
  "status": "pass"
}
```

**Example: Production Approval**
```json
{
  "approval_date": "2025-02-13T09:00:00Z",
  "decision": "approved",
  "approvers": {
    "executive_sponsor": {
      "name": "Executive Sponsor",
      "role": "Executive Sponsor",
      "approval_status": "approved",
      "approval_timestamp": "2025-02-13T08:45:00Z",
      "comments": "All readiness gates passed, proceed with deployment"
    },
    "sre_lead": {
      "name": "SRE Lead",
      "role": "SRE/Operations Lead",
      "approval_status": "approved",
      "approval_timestamp": "2025-02-13T08:50:00Z",
      "comments": "Monitoring coverage confirmed, rollback plan validated"
    },
    "security_lead": {
      "name": "Security Lead",
      "role": "Security Lead",
      "approval_status": "approved",
      "approval_timestamp": "2025-02-13T09:00:00Z",
      "comments": "Security scans passed, no blocking findings"
    }
  },
  "required_approvers": 3,
  "approvers_count": 3,
  "approval_percentage": 100
}
```

**Example: Production Deployment Report**
```json
{
  "deployment_date": "2025-02-13T10:00:00Z",
  "status": "success",
  "deployment_type": "blue-green",
  "release_tag": "v1.0.0",
  "steps": [
    {
      "step": "1",
      "action": "Deploy to blue environment",
      "command": "bash scripts/deploy_backend.sh --env production --release v1.0.0 --strategy blue-green",
      "status": "success",
      "duration_seconds": 240,
      "errors": []
    },
    {
      "step": "2",
      "action": "Switch traffic to blue",
      "command": "bash scripts/switch_traffic.sh --target blue",
      "status": "success",
      "duration_seconds": 60,
      "errors": []
    },
    {
      "step": "3",
      "action": "Verify service health",
      "command": "bash scripts/health_check.sh --env production",
      "status": "success",
      "duration_seconds": 120,
      "errors": []
    }
  ],
  "total_duration_seconds": 420,
  "blocking_incidents": 0
}
```

**Example: Post-Deployment Validation**
```json
{
  "validation_date": "2025-02-13T10:15:00Z",
  "status": "pass",
  "validation_success_rate": 98,
  "checks": {
    "smoke_tests": {
      "status": "pass",
      "tests_run": 20,
      "tests_passed": 20,
      "tests_failed": 0
    },
    "health_checks": {
      "status": "pass",
      "services_checked": 5,
      "services_healthy": 5,
      "services_unhealthy": 0
    },
    "service_verifications": {
      "status": "pass",
      "endpoints_verified": 15,
      "endpoints_healthy": 15,
      "endpoints_unhealthy": 0
    }
  },
  "metrics_snapshot": {
    "api_latency_p95": 250,
    "error_rate": 0.1,
    "throughput": 1000
  }
}
```

### ‚ùå Anti-Patterns to Avoid

**Anti-Pattern 1: Deploying Without Production Approval**
```json
// ‚ùå WRONG - Deployment started without approval
{
  "deployment_started": true,
  "production_approval": {
    "status": "pending"  // Missing
  }
}

// ‚úÖ CORRECT - Approval obtained before deployment
{
  "deployment_started": true,
  "production_approval": {
    "status": "approved",
    "approval_date": "2025-02-13T09:00:00Z",
    "approvers_count": 3
  }
}
```
**Why:** Gate 3 requires production approval recorded. Deploying without approval violates protocol critical directive and risks unauthorized changes.

**Anti-Pattern 2: Change Freeze Not Acknowledged**
```markdown
<!-- ‚ùå WRONG - Change freeze not acknowledged by all stakeholders -->
# Change Freeze Confirmation

- Team A: Acknowledged ‚úÖ
- Team B: Pending ‚è≥  <!-- Missing -->
- Team C: Acknowledged ‚úÖ

<!-- ‚úÖ CORRECT - All stakeholders acknowledged -->
# Change Freeze Confirmation

- Team A: Acknowledged ‚úÖ
- Team B: Acknowledged ‚úÖ
- Team C: Acknowledged ‚úÖ
- All stakeholders: 100% acknowledged
```
**Why:** Gate 2 requires freeze acknowledgements = 100% of required stakeholders. Missing acknowledgements risk conflicting changes during deployment.

**Anti-Pattern 3: Post-Deployment Validation Failures**
```json
// ‚ùå WRONG - Validation failures not addressed
{
  "status": "fail",
  "validation_success_rate": 80,  // Below 95% threshold
  "checks": {
    "smoke_tests": {
      "status": "fail",
      "tests_failed": 5  // Failures not resolved
    }
  }
}

// ‚úÖ CORRECT - All validations pass
{
  "status": "pass",
  "validation_success_rate": 98,
  "checks": {
    "smoke_tests": {
      "status": "pass",
      "tests_passed": 20,
      "tests_failed": 0
    }
  }
}
```
**Why:** Gate 3 requires validation success rate ‚â• 95%. Below-threshold validation indicates deployment issues that require rollback.

**Anti-Pattern 4: Metrics Outside SLO Tolerances**
```json
// ‚ùå WRONG - Metrics outside SLO tolerances
{
  "metrics": {
    "api_latency_p95": 500,  // SLO: 300ms
    "error_rate": 2.5,       // SLO: 0.5%
    "slo_violations": 2
  }
}

// ‚úÖ CORRECT - Metrics within SLO tolerances
{
  "metrics": {
    "api_latency_p95": 250,
    "error_rate": 0.1,
    "slo_violations": 0
  }
}
```
**Why:** Gate 4 requires metrics within SLO tolerances. SLO violations indicate performance degradation requiring escalation.

**Anti-Pattern 5: Missing Deployment Report**
```bash
# ‚ùå WRONG - Deployment complete but report not compiled
.artifacts/deployment/
  ‚îú‚îÄ‚îÄ production-deployment-report.json ‚úÖ
  ‚îú‚îÄ‚îÄ post-deployment-validation.json ‚úÖ
  # Missing: DEPLOYMENT-REPORT.md
  # Gate 4 cannot pass

# ‚úÖ CORRECT - Complete deployment report
.artifacts/deployment/
  ‚îú‚îÄ‚îÄ DEPLOYMENT-REPORT.md ‚úÖ (completeness ‚â• 95%)
  ‚îú‚îÄ‚îÄ DEPLOYMENT-EVIDENCE.zip ‚úÖ
  ‚îî‚îÄ‚îÄ retrospective-inputs.json ‚úÖ
```
**Why:** Gate 4 requires release report compiled. Missing reports prevent audit trail and cause compliance issues.

**Anti-Pattern 6: Rollback Plan Not Verified**
```json
// ‚ùå WRONG - Deployment ready but rollback not verified
{
  "readiness_checklist": {
    "rollback_verification": {
      "status": "pending"  // Not verified
    }
  }
}

// ‚úÖ CORRECT - Rollback plan verified
{
  "readiness_checklist": {
    "rollback_verification": {
      "status": "verified",
      "artifact": "rollback-verification-report.json",
      "rto_met": true
    }
  }
}
```
**Why:** Gate 1 requires rollback plan verified. Missing verification risks inability to recover from deployment failures.

**Anti-Pattern 7: Staging Health Not Reconfirmed**
```json
// ‚ùå WRONG - Production deployment without staging reconfirmation
{
  "staging_validation": {
    "status": "pending",  // Not reconfirmed
    "last_validation": "2025-02-12T11:00:00Z"  // Stale
  },
  "production_deployment_started": true
}

// ‚úÖ CORRECT - Staging health reconfirmed before production
{
  "staging_validation": {
    "status": "confirmed",
    "validation_date": "2025-02-13T09:30:00Z",
    "health_status": "healthy"
  },
  "production_deployment_started": true
}
```
**Why:** Gate 2 requires staging health reconfirmed. Missing reconfirmation risks deploying with staging issues to production.

**Anti-Pattern 8: Incomplete Deployment Evidence**
```bash
# ‚ùå WRONG - Deployment complete but evidence incomplete
.artifacts/deployment/
  ‚îú‚îÄ‚îÄ production-deployment-report.json ‚úÖ
  # Missing: post-deployment-validation.json
  # Missing: deployment-health-log.md
  # Report completeness < 95%

# ‚úÖ CORRECT - Complete deployment evidence
.artifacts/deployment/
  ‚îú‚îÄ‚îÄ deployment-readiness-checklist.json ‚úÖ
  ‚îú‚îÄ‚îÄ production-approval.json ‚úÖ
  ‚îú‚îÄ‚îÄ production-deployment-report.json ‚úÖ
  ‚îú‚îÄ‚îÄ post-deployment-validation.json ‚úÖ
  ‚îú‚îÄ‚îÄ deployment-health-log.md ‚úÖ
  ‚îú‚îÄ‚îÄ DEPLOYMENT-REPORT.md ‚úÖ
  ‚îî‚îÄ‚îÄ DEPLOYMENT-EVIDENCE.zip ‚úÖ
```
**Why:** Gate 4 requires report completeness ‚â• 95%. Incomplete evidence prevents audit trail and recovery documentation.
