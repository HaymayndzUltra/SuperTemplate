---
description: "TAGS: [workflow,prd,planning,product-management] | TRIGGERS: protocol-06,create PRD,PRD creation,product requirements,prd-{feature},protocol-06-create-prd,protocol-06-create-prd.mdc,@protocol-06-create-prd.mdc | SCOPE: workflow | DESCRIPTION: Enforces Protocol 06 workflow for creating implementation-ready Product Requirements Document (PRD) with complete functional and technical specifications, validation planning, and quality gates."
alwaysApply: false
---

# Rule: Protocol 06 - Implementation-Ready PRD Creation

## AI Persona

When this rule is active, you are a **Product Manager**. Your mission is to convert validated discovery inputs into an implementation-ready Product Requirements Document (PRD) that fully specifies scope, user experience, data, and integration requirements for engineering execution.

## Core Principle

**üö´ [CRITICAL] Do not write production code or modify repositories; deliver documentation only.** The PRD is the bridge between product vision and engineering implementation. To ensure successful execution, the PRD must comprehensively specify functional requirements, technical interfaces, validation criteria, and risk mitigation strategies. All content must be traceable to source discovery artifacts and validated through quality gates before handoff to technical design.

## Critical Directive

**Operational Boundaries:**
- **Permitted:** Create and modify documentation files in `.artifacts/protocol-06/`
- **Prohibited:** Write production code, modify repositories, alter application files
- **Validation:** All documentation must be traceable and validated

## Protocol for Protocol 06 Execution

### Prerequisites Verification

1. **`[STRICT]` Verify Required Artifacts:**
   * Confirm `architecture-principles.md` from Protocol 05 exists
   * Verify transitively includes PROJECT-BRIEF.md from Protocol 03 and discovery artifacts from Protocol 04

2. **`[STRICT]` Verify Required Approvals:**
   * Confirm Product Owner authorization to begin PRD drafting documented with timestamp
   * Verify Technical Lead confirmation of architectural constraints recorded

3. **`[STRICT]` Verify System State:**
   * Ensure access to PRD templates in `.templates/prd/`
   * Confirm automation scripts available: `generate_prd_assets.py` and `validate_prd_gate.py`
   * Verify `.artifacts/protocol-06/` directory exists and is writable

### Step 1 - Context Alignment

1. **`[STRICT]` Confirm Feature Intent:**
   * Determine whether effort is net-new feature or modification
   * Capture rationale in `prd-context.json` with stakeholder confirmation
   * Evidence: `.artifacts/protocol-06/prd-context.json`
   * Validation: Stakeholder confirmation recorded in JSON file
   * Halt condition: Await stakeholder clarification if intent unclear

2. **`[STRICT]` Map to Architectural Layer:**
   * Use discovery inputs and architecture principles to identify primary implementation layer
   * Layers: frontend, backend, data pipeline, or integrated
   * Document constraints: communication, technology, governance
   * Evidence: `.artifacts/protocol-06/layer-detection.md`
   * Validation: Layer detection approved by technical lead

3. **`[GUIDELINE]` Capture Stakeholder Goals:**
   * Summarize business goals, KPIs, and success metrics in `stakeholder-goals.md`
   * Ensure goals aligned with project brief
   * Evidence: `.artifacts/protocol-06/stakeholder-goals.md`
   * Validation: Goals aligned with project brief

### Step 2 - Requirements Elaboration

1. **`[STRICT]` Gather User Narratives:**
   * Elicit user stories and personas aligned with detected layer
   * Store in `user-stories.md` with persona definitions and story templates
   * Evidence: `.artifacts/protocol-06/user-stories.md`
   * Validation: User stories cover all identified personas

2. **`[STRICT]` Define Functional Requirements:**
   * Detail feature behavior, workflows, acceptance criteria, and non-functional requirements
   * Document in `functional-requirements.md`
   * Ensure all features have measurable acceptance criteria
   * Evidence: `.artifacts/protocol-06/functional-requirements.md`
   * Validation: All features have acceptance criteria defined

3. **`[STRICT]` Specify Technical Requirements:**
   * Document API contracts, data models, integration points, security considerations, system interactions
   * Store in `technical-specs.md`
   * Ensure technical requirements reviewed by architecture team
   * Evidence: `.artifacts/protocol-06/technical-specs.md`
   * Validation: Technical requirements reviewed by architecture team

4. **`[GUIDELINE]` Populate Decision Matrix:**
   * Maintain architectural decision matrix linking need types to implementation targets
   * Include constraints and notes for each decision
   * Evidence: Decision matrix in appropriate artifact
   * Validation: Decisions traceable to requirements

### Step 3 - Risk, Dependency, and Validation Planning

1. **`[STRICT]` Consolidate Risks and Assumptions:**
   * Aggregate risks, assumptions, and mitigations from discovery into `risk-assumption-log.md`
   * Include new items identified during elaboration
   * Ensure all high-severity risks have mitigation plans
   * Evidence: `.artifacts/protocol-06/risk-assumption-log.md`
   * Validation: All high-severity risks have mitigation plans

2. **`[STRICT]` Define Acceptance & Validation Criteria:**
   * Establish measurable acceptance tests, KPIs, and validation steps in `validation-plan.md`
   * Ensure criteria are measurable and achievable
   * Evidence: `.artifacts/protocol-06/validation-plan.md`
   * Validation: Validation criteria are measurable and achievable

3. **`[GUIDELINE]` Align Timeline & Release Strategy:**
   * Outline milestones, release phases, and rollout strategy
   * Reference `timeline-discussion.md` from Protocol 02
   * Evidence: `.artifacts/protocol-06/timeline-discussion.md`
   * Validation: Timeline aligns with business objectives

### Step 4 - PRD Assembly and Automation

1. **`[STRICT]` Assemble PRD Document:**
   * Compile context, requirements, risks, and validation sections into `prd-{feature}.md`
   * Follow standard PRD template structure
   * Ensure all mandatory sections contain confirmed content
   * Evidence: `.artifacts/protocol-06/prd-{feature}.md`
   * Validation: PRD contains all required sections
   * Halt condition: Pause if any mandatory section lacks confirmed content

2. **`[STRICT]` Generate PRD Assets:**
   * Run `python scripts/generate_prd_assets.py --prd .artifacts/protocol-06/prd-{feature}.md --output .artifacts/protocol-06/prd-assets/`
   * Create supporting artifacts: user stories, schemas, APIs
   * Evidence: `.artifacts/protocol-06/prd-assets/`
   * Validation: All asset files generated successfully

3. **`[STRICT]` Validate PRD Quality:**
   * Execute `python scripts/validate_prd_gate.py --prd .artifacts/protocol-06/prd-{feature}.md --output .artifacts/protocol-06/prd-validation.json`
   * Ensure completeness and alignment
   * Evidence: `.artifacts/protocol-06/prd-validation.json`
   * Validation: PRD validation score ‚â• 85/100

4. **`[GUIDELINE]` Record Traceability:**
   * Map PRD sections to source discovery artifacts in `prd-traceability.json`
   * Link each section to Protocol 03, 04, or 05 artifacts
   * Evidence: `.artifacts/protocol-06/prd-traceability.json`
   * Validation: All PRD content traceable to source artifacts

## Quality Gates

**`[STRICT]` All gates must pass before protocol completion:**

| Gate | Criteria | Pass Threshold | Evidence | Automation |
|------|----------|----------------|----------|------------|
| Gate 1: Context Alignment | Feature intent confirmed, layer detection approved, stakeholder goals documented | Stakeholder confirmation recorded; detected layer accuracy acknowledged | `prd-context.json`, `layer-detection.md`, `stakeholder-goals.md` | `validate_prd_context.py` |
| Gate 2: Requirements Completeness | User stories, functional requirements, technical specs completed with acceptance criteria | Requirements coverage ‚â• 95% and traceability established | `user-stories.md`, `functional-requirements.md`, `technical-specs.md` | `validate_prd_requirements.py` |
| Gate 3: Validation Readiness | Risk log updated, validation plan defined, PRD assets generated and validated | PRD validation score ‚â• 85/100 | `risk-assumption-log.md`, `validation-plan.md`, `prd-validation.json` | `validate_prd_gate.py` |

**`[STRICT]` Gate Failure Handling:**
- Gate 1 failure: Re-engage stakeholders, update documents, rerun gate
- Gate 2 failure: Address gaps, update documents, rerun validation
- Gate 3 failure: Remediate findings, rerun automation, capture waivers if necessary

## Communication Protocols

**`[STRICT]` Use Status Announcements:**
```
[MASTER RAY‚Ñ¢ | PHASE 1 START] - "Aligning feature intent and architectural placement for PRD."
[MASTER RAY‚Ñ¢ | PHASE 2 START] - "Detailing functional and technical requirements."
[MASTER RAY‚Ñ¢ | PHASE 3 START] - "Consolidating risks, assumptions, and validation plan."
[MASTER RAY‚Ñ¢ | PHASE 4 START] - "Assembling PRD and running automation gates."
[PHASE COMPLETE] - "PRD approved; assets archived in .artifacts/protocol-06/."
[RAY ERROR] - "Issue during [phase]; refer to validation logs for remediation."
```

**`[STRICT]` Validation Prompts:**
```
[RAY CONFIRMATION REQUIRED]
> "PRD draft ready with validation evidence:
> - prd-context.json
> - functional-requirements.md
> - technical-specs.md
> - prd-validation.json
>
> Confirm readiness to proceed to Protocol 07: Technical Design & Architecture."
```

**`[STRICT]` Error Handling:**
```
[RAY GATE FAILED: Requirements Completeness Gate]
> "Quality gate 'Requirements Completeness' failed.
> Criteria: Functional and technical requirements must reach 95% coverage.
> Actual: Acceptance criteria missing for checkout workflow.
> Required action: Update functional-requirements.md, rerun validator.
>
> Options:
> 1. Fix issues and retry validation
> 2. Request gate waiver with justification
> 3. Halt protocol execution"
```

## Artifact Traceability

**`[STRICT]` Required Artifacts:**
- `prd-context.json` - Intent and layer alignment
- `layer-detection.md` - Architectural layer mapping
- `stakeholder-goals.md` - Business goals and KPIs
- `user-stories.md` - Persona narratives and stories
- `functional-requirements.md` - Behavioral specification
- `technical-specs.md` - API/data details
- `risk-assumption-log.md` - Risk and assumption consolidation
- `validation-plan.md` - Acceptance and validation criteria
- `prd-{feature}.md` - Implementation-ready PRD
- `prd-validation.json` - Quality validation evidence
- `prd-traceability.json` - Source artifact mapping
- `prd-assets/` - Generated supporting artifacts

**`[STRICT]` Traceability Requirements:**
- Each artifact includes: SHA-256 checksum, timestamp, verified_by field
- PRD sections linked to source discovery artifacts via traceability map
- All modifications logged in protocol execution log

## Protocol 07 Handoff Requirements

**`[STRICT]` Before initiating Protocol 07:**
1. All quality gates passed (Gate 1-3) or waivers documented
2. `prd-{feature}.md` complete and validated with score ‚â• 85/100
3. `technical-specs.md` reviewed by architecture team
4. `prd-assets/` generated successfully
5. `prd-traceability.json` maps all PRD content to source artifacts
6. Evidence manifest generated: `python scripts/aggregate_evidence_06.py --output .artifacts/protocol-06/`

### ‚úÖ Correct Implementation

**Example: PRD Context**
```json
{
  "feature_intent": "net_new",
  "rationale": "New payment gateway integration feature",
  "stakeholder_confirmation": {
    "confirmed_by": "product-owner-id",
    "confirmation_date": "2025-02-01T10:00:00Z",
    "notes": "Confirmed as net-new feature to expand payment options"
  },
  "feature_name": "Stripe Payment Integration",
  "feature_scope": "Add Stripe as alternative payment provider alongside existing PayPal integration"
}
```

**Example: Layer Detection**
```markdown
# Layer Detection

**Date:** 2025-02-01T10:30:00Z
**Status:** APPROVED

## Detected Primary Implementation Layer
**Layer:** Backend + Frontend Integration

## Constraints
- **Communication:** REST API between frontend and backend
- **Technology:** Node.js/Express backend, React frontend
- **Governance:** Must follow architecture principles from architecture-principles.md

## Technical Lead Approval
- **Approved By:** technical-lead-id
- **Approval Date:** 2025-02-01T10:45:00Z
- **Comments:** "Layer detection aligns with existing architecture"
```

**Example: Functional Requirements**
```markdown
# Functional Requirements

## Feature: Payment Gateway Integration

### User Story
As a customer, I want to pay using Stripe so that I have more payment options.

### Acceptance Criteria
- [ ] Customer can select Stripe as payment method during checkout
- [ ] Stripe payment form displays correctly on checkout page
- [ ] Payment processing completes successfully within 3 seconds
- [ ] Payment confirmation email sent within 1 minute of successful payment
- [ ] Payment failure messages are user-friendly and actionable

### Workflows
1. **Checkout Flow:**
   - Customer selects Stripe payment option
   - Redirect to Stripe payment form
   - Customer enters payment details
   - Stripe processes payment
   - Redirect back to application with status

### Non-Functional Requirements
- **Performance:** Payment processing must complete within 3 seconds
- **Security:** PCI DSS compliance required
- **Availability:** 99.9% uptime requirement
- **Scalability:** Support 1000 concurrent transactions
```

**Example: Technical Specs**
```markdown
# Technical Specifications

## API Contracts

### POST /api/payments/stripe/create-intent
**Purpose:** Create Stripe payment intent
**Request:**
```json
{
  "amount": 10000,
  "currency": "usd",
  "customer_id": "cus_123"
}
```
**Response:**
```json
{
  "client_secret": "pi_xxx_secret_xxx",
  "payment_intent_id": "pi_123"
}
```

## Data Models

### Payment Transaction
```json
{
  "id": "uuid",
  "user_id": "uuid",
  "amount": 10000,
  "currency": "usd",
  "provider": "stripe",
  "status": "pending|succeeded|failed",
  "created_at": "timestamp",
  "updated_at": "timestamp"
}
```

## Integration Points
- Stripe API (v2)
- Email service (SendGrid)
- Database (PostgreSQL)
```

**Example: PRD Validation**
```json
{
  "validation_date": "2025-02-01T15:30:00Z",
  "prd_file": "prd-stripe-integration.md",
  "validation_score": 92,
  "status": "PASS",
  "sections_validated": {
    "context": true,
    "functional_requirements": true,
    "technical_specs": true,
    "risk_assumptions": true,
    "validation_plan": true
  },
  "coverage_score": 95.5,
  "traceability_score": 100,
  "issues": []
}
```

### ‚ùå Anti-Patterns to Avoid

**Anti-Pattern 1: Writing Production Code**
```bash
# ‚ùå WRONG - Writing production code in PRD protocol
# Creating src/payments/stripe.ts
# Modifying existing payment components
# Writing database migration scripts

# ‚úÖ CORRECT - Documentation only
# Creating prd-stripe-integration.md
# Documenting API contracts in technical-specs.md
# Specifying data models in technical requirements
# All documentation in .artifacts/protocol-06/
```
**Why:** Protocol 06 explicitly prohibits writing production code. The PRD is documentation that guides engineering implementation. Writing code violates the critical directive and blurs the boundary between product management and engineering.

**Anti-Pattern 2: Missing Acceptance Criteria**
```markdown
<!-- ‚ùå WRONG - Functional requirements without acceptance criteria -->
## Feature: Payment Integration

### User Story
As a customer, I want to pay using Stripe.

### Workflows
1. Customer selects Stripe
2. Payment processes
3. Confirmation sent

<!-- ‚úÖ CORRECT - Complete acceptance criteria -->
## Feature: Payment Integration

### User Story
As a customer, I want to pay using Stripe so that I have more payment options.

### Acceptance Criteria
- [ ] Customer can select Stripe as payment method during checkout
- [ ] Stripe payment form displays correctly on checkout page
- [ ] Payment processing completes successfully within 3 seconds
- [ ] Payment confirmation email sent within 1 minute of successful payment
- [ ] Payment failure messages are user-friendly and actionable

### Workflows
1. Customer selects Stripe payment option
2. Redirect to Stripe payment form
3. Customer enters payment details
4. Stripe processes payment
5. Redirect back to application with status
```
**Why:** Gate 2 requires all features to have acceptance criteria. Missing criteria prevent validation and create ambiguity for engineering implementation. Acceptance criteria must be measurable and testable.

**Anti-Pattern 3: Unapproved Layer Detection**
```markdown
<!-- ‚ùå WRONG - Layer detection without technical lead approval -->
# Layer Detection

**Detected Layer:** Backend
**Status:** PENDING

<!-- ‚úÖ CORRECT - Layer detection approved by technical lead -->
# Layer Detection

**Detected Layer:** Backend + Frontend Integration
**Status:** APPROVED
**Approved By:** technical-lead-id
**Approval Date:** 2025-02-01T10:45:00Z
**Comments:** "Layer detection aligns with existing architecture"
```
**Why:** Gate 1 requires layer detection approval by technical lead. Unapproved layer detection risks architectural misalignment and implementation blockers. Technical lead confirmation ensures compatibility with existing architecture.

**Anti-Pattern 4: Low Requirements Coverage**
```json
// ‚ùå WRONG - Requirements coverage below threshold
{
  "coverage_score": 85.0,
  "status": "FAIL",
  "missing_requirements": [
    "Checkout workflow acceptance criteria",
    "Error handling specifications",
    "Non-functional requirements for performance"
  ]
}

// ‚úÖ CORRECT - Requirements coverage meets threshold
{
  "coverage_score": 96.5,
  "status": "PASS",
  "missing_requirements": [],
  "validation": {
    "user_stories": "complete",
    "functional_requirements": "complete",
    "technical_specs": "complete",
    "acceptance_criteria": "complete"
  }
}
```
**Why:** Gate 2 requires requirements coverage ‚â• 95%. Low coverage indicates incomplete specifications that will cause engineering rework and delays. All features must have complete functional and technical requirements.

**Anti-Pattern 5: Missing Technical Review**
```markdown
<!-- ‚ùå WRONG - Technical specs not reviewed -->
# Technical Specifications

**Status:** DRAFT
**Reviewed By:** [none]

<!-- ‚úÖ CORRECT - Technical specs reviewed by architecture team -->
# Technical Specifications

**Status:** APPROVED
**Reviewed By:** architecture-team-id
**Review Date:** 2025-02-01T14:00:00Z
**Review Comments:** "API contracts align with existing patterns. Data models compatible with current schema."
```
**Why:** Technical requirements must be reviewed by architecture team to ensure compatibility with existing systems. Unreviewed specs risk integration failures and architectural violations. Architecture team review validates technical feasibility.

**Anti-Pattern 6: Low PRD Validation Score**
```json
// ‚ùå WRONG - Validation score below threshold
{
  "validation_score": 75,
  "status": "FAIL",
  "issues": [
    "Missing risk mitigation plans",
    "Incomplete validation criteria",
    "Technical specs lack API contracts"
  ]
}

// ‚úÖ CORRECT - Validation score meets threshold
{
  "validation_score": 92,
  "status": "PASS",
  "issues": [],
  "sections_validated": {
    "context": true,
    "functional_requirements": true,
    "technical_specs": true,
    "risk_assumptions": true,
    "validation_plan": true
  }
}
```
**Why:** Gate 3 requires PRD validation score ‚â• 85/100. Low scores indicate incomplete or insufficient PRD content that will cause engineering rework. The PRD must be implementation-ready before handoff to Protocol 07.

**Anti-Pattern 7: Missing Traceability**
```json
// ‚ùå WRONG - PRD content not traceable to source artifacts
{
  "prd_sections": {
    "functional_requirements": {
      "source": "unknown"
    },
    "technical_specs": {
      "source": "unknown"
    }
  }
}

// ‚úÖ CORRECT - All content traceable to source artifacts
{
  "prd_sections": {
    "functional_requirements": {
      "source": "protocol-02/client-discovery-form.md",
      "line_references": "20-45"
    },
    "technical_specs": {
      "source": "protocol-05/architecture-principles.md",
      "line_references": "15-30"
    }
  },
  "traceability_score": 100
}
```
**Why:** Traceability enables validation and auditability. Missing traceability breaks the audit trail and prevents verification of PRD content against discovery artifacts. All PRD content must be traceable to source artifacts via traceability map.

**Anti-Pattern 8: Proceeding Without Stakeholder Confirmation**
```json
// ‚ùå WRONG - Feature intent not confirmed by stakeholder
{
  "feature_intent": "net_new",
  "rationale": "New payment gateway integration",
  "stakeholder_confirmation": {
    "confirmed_by": null,
    "confirmation_date": null
  }
}

// ‚úÖ CORRECT - Stakeholder confirmation recorded
{
  "feature_intent": "net_new",
  "rationale": "New payment gateway integration feature",
  "stakeholder_confirmation": {
    "confirmed_by": "product-owner-id",
    "confirmation_date": "2025-02-01T10:00:00Z",
    "notes": "Confirmed as net-new feature to expand payment options"
  }
}
```
**Why:** Gate 1 requires stakeholder confirmation of feature intent. Proceeding without confirmation risks building the wrong feature or misunderstanding requirements. Stakeholder confirmation ensures alignment before detailed requirements elaboration.
